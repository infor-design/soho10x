<!DOCTYPE html>
<html>
<head>
	<!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge'><![endif]-->
	<meta charset="utf-8">

	<title>Infor DataGrid : Grouping and Totals </title>
	<link rel="stylesheet" href="../Release/inforControlsCombined.css"/>

	<script src="../Release/jquery-1.10.2.min.js"></script>
	<script src="../Release/jquery-ui-1.10.2.custom.min.js"></script>
	<script src="../Release/inforControlsCombined.js"></script>

	<!--Redundent imports but allows me to change grid code without a recompile-->
	<script src="js/inforDataGrid.js"></script>
	<link rel="stylesheet" href="../inforDataGrid/css/inforDataGrid.css" />

</head>
<body>
	<div>
	   <div class="inforToolbar"></div>
	   <div id="inforDataGrid"></div>
	</div>

	<script>
		//Globalize.culture("ar-SA");

		var grid,
			columns = [];

		columns.push({ id: "cust1", name: "Cust1", field: "cust1", width: 80, editor: TextCellEditor, filterType: TextFilter});
		columns.push({ id: "cust2", name: "Cust2", field: "cust2", width: 80, editor: TextCellEditor, filterType: TextFilter});
		columns.push({ id: "cust3", name: "Cust3", field: "cust3", width: 80, editor: TextCellEditor, filterType: TextFilter});
		columns.push({ id: "percAllocation", name: "Allocation %", field: "percAllocation", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter, groupTotalsFormatter: sumTotalsFormatter});
		columns.push({ id: "jan", name: "Jan", field: "jan", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter, groupTotalsFormatter: sumTotalsFormatter});
		columns.push({ id: "feb", name: "Feb", field: "feb", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter, groupTotalsFormatter: sumTotalsFormatter});
		columns.push({ id: "mar", name: "Mar", field: "mar", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter, groupTotalsFormatter: sumTotalsFormatter});
		columns.push({ id: "apr", name: "Apr", field: "apr", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter, groupTotalsFormatter: sumTotalsFormatter});
		columns.push({ id: "jun", name: "Jun", field: "jun", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter, groupTotalsFormatter: sumTotalsFormatter});
		columns.push({ id: "jul", name: "Jul", field: "jul", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter, groupTotalsFormatter: sumTotalsFormatter});
		columns.push({ id: "aug", name: "Aug", field: "aug", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter, groupTotalsFormatter: sumTotalsFormatter});
		columns.push({ id: "sep", name: "Sept", field: "sep", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter, groupTotalsFormatter: sumTotalsFormatter});

		var data = [];
		data.push({ rowid : '0', cust1: 'ABC', cust2: '123', cust3: 'A1', percAllocation:  null, jan: 10, feb: null, mar: 10, apr: 5, may: 8, jun: 30, jul: 1, aug: 5, sep: 30});
		data.push({ rowid : '1', cust1: 'ABC', cust2: '456', cust3: 'A1', percAllocation: null, jan: 10, feb: 20, mar: null, apr: 5, may: 30, jun: 30, jul: 30, aug: 30, sep: 30});
		data.push({ rowid : '3', cust1: 'ABC', cust2: '789', cust3: 'A2', percAllocation: 40, jan: 10, feb: null, mar: 10, apr: 5, may: 30, jun: 30, jul: 30, aug: 5, sep: 30});
		data.push({ rowid : '4', cust1: 'DEF', cust2: '123', cust3: 'A2', percAllocation: null, jan: 10, feb: 20, mar: 10, apr: 5, may: 30, jun: 2, jul: 30, aug: 30, sep: 30});
		data.push({ rowid : '5', cust1: 'DEF', cust2: '789', cust3: 'A2', percAllocation: null, jan: 10, feb: 20, mar: 10, apr: 5, may: 30, jun: 30, jul: 30, aug: 30, sep: 30});
		data.push({ rowid : '6', cust1: 'GHI', cust2: '123', cust3: 'A3', percAllocation: 30, jan: 10, feb: 20, mar: null, apr: 5, may: 30, jun: 3, jul: 30, aug: 30, sep: 30});
		data.push({ rowid : '7', cust1: 'GHI', cust2: '456', cust3: 'A4', percAllocation: null, jan: 10, feb: null, mar: 10, apr: 5, apr: 5, may: 30, jun: 30, jul: 6, aug: 30, sep: 9});
		data.push({ rowid : '8', cust1: 'GHI', cust2: '789', cust3: 'A5', percAllocation: 30, jan: 10, feb: 20, mar: 10, apr: 5, apr: 5, may: 30, jun: 30, jul: 2, aug: 30, sep: 30});

		var options = {
			columns: columns,
			idProperty:'rowid',
			dataset: data,
			showFilter: true,
			showDrillDown: false,
			showFooter: true,
			showGridSettings: true,
			showFilter: true,
			forceFitColumns: false,
			showCheckboxes: true,
			showGridSettings:false,
			enableGrouping: true,
			savePersonalization: false,
			frozenColumn: 4,
			multiSelect:true

		};

		grid = $("#inforDataGrid").inforDataGrid(options);

		//Add grouping and sum totals
		var dataView = grid.getData();
		dataView.groupBy(
			"cust2",
			function (g) {
				return "<span class='inforGroupText'> Customer:  " + g.value + "  <span class='inforGroupSummaryText'>(" + g.count + " items)</span></span>";
			},
			function (a, b) {return a.value - b.value;}	//sorting comparer.
		);

		dataView.setAggregators([
			new Slick.Data.Aggregators.Sum("percAllocation"),
			new Slick.Data.Aggregators.Sum("jan"),
			new Slick.Data.Aggregators.Sum("feb"),
			new Slick.Data.Aggregators.Sum("mar"),
			new Slick.Data.Aggregators.Sum("apr"),
			new Slick.Data.Aggregators.Sum("jun"),
			new Slick.Data.Aggregators.Sum("jul"),
			new Slick.Data.Aggregators.Sum("aug"),
			new Slick.Data.Aggregators.Sum("sep")
		], false);

		function sumTotalsFormatter(totals, columnDef) {
			return "<span style='float: right'>" + Math.round(totals.sum[columnDef.field]) + "</span>";
		}
	</script>
</body>
</html>
