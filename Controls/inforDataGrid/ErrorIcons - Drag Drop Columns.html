<!DOCTYPE html>
<head>
	<!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge'><![endif]-->

	<title>Infor DataGrid : Nested Headers</title>

    <script src="../Release/jquery-1.11.1.min.js"></script>
	<script src="../Release/jquery-ui-1.10.4.custom.min.js"></script>
	<script src="../Release/inforControlsCombined.js"></script>

	<!--Redundent imports but allows me to change grid code without a recompile-->
	<script src="js/inforDataGrid.js"></script>
	<link rel="stylesheet" href="../Release/inforControlsCombined.css" />

	<!--Load a Flat file with JSON data-->
	<script src="js/sampleData.js"></script>
	
</head>
<body>
	<div id="inforDatagrid1" class='inforDataGrid'></div>
    <div id="spacing" ></div>
	<div id="inforDataGrid" class='inforDataGrid'></div>
	<script>
		function validator(value, item){
			var result = {valid: true};
			if(!value){
			    result.valid = false;
				result.msg = 'Please provide a value';
			} else {
				if(Number(value) > 100) {
					result.valid = false;
					result.msg = 'Value must not be greater than 100';
				}
			}
			
			return result;
		}
	
		function sumTotalsFormatter(totals, columnDef) {
			var sum = Math.round(totals.sum[columnDef.field]);
			var show = "";
			if(sum > 0)  show = sum;
			return  "<span style='float: right'>" + show + "</span>";
		}
		
		var columns1 = [];

		columns1.push({ id: "cust1", name: "Cust1", field: "cust1", width: 80, editor: TextCellEditor});
		columns1.push({ id: "cust2", name: "Cust2", field: "cust2", width: 80, editor: DateCellEditor});
		columns1.push({ id: "cust3", name: "Cust3", field: "cust3", width: 80, editor: DateCellEditor});
		columns1.push({ id: "percAllocation", name: "Allocation %", field: "percAllocation", width: 80, headerCssClass: "alignHeaderRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, groupTotalsFormatter: sumTotalsFormatter, editor: IntegerCellEditor});
		columns1.push({ id: "jan", name: "Jan", field: "jan", width: 80, headerCssClass: "alignHeaderRight", validator: validator, formatter: IntegerCellFormatter, editor: IntegerCellEditor, groupTotalsFormatter: sumTotalsFormatter});
		columns1.push({ id: "feb", name: "Feb", field: "feb", width: 80, headerCssClass: "alignHeaderRight", validator: validator, formatter: IntegerCellFormatter, editor: IntegerCellEditor, groupTotalsFormatter: sumTotalsFormatter});
		columns1.push({ id: "mar", name: "Mar", field: "mar", width: 80, headerCssClass: "alignHeaderRight", validator: validator, formatter: IntegerCellFormatter, editor: IntegerCellEditor, groupTotalsFormatter: sumTotalsFormatter});
		columns1.push({ id: "apr", name: "Apr", field: "apr", width: 80, headerCssClass: "alignHeaderRight", validator: validator, formatter: IntegerCellFormatter, editor: IntegerCellEditor, groupTotalsFormatter: sumTotalsFormatter});
		columns1.push({ id: "jun", name: "Jun", field: "jun", width: 80, headerCssClass: "alignHeaderRight", validator: validator, formatter: IntegerCellFormatter, editor: IntegerCellEditor, groupTotalsFormatter: sumTotalsFormatter});
		columns1.push({ id: "jul", name: "Jul", field: "jul", width: 80, headerCssClass: "alignHeaderRight", validator: validator, formatter: IntegerCellFormatter, editor: IntegerCellEditor, groupTotalsFormatter: sumTotalsFormatter});
		columns1.push({ id: "aug", name: "Aug", field: "aug", width: 80, headerCssClass: "alignHeaderRight",validator: validator,  formatter: IntegerCellFormatter, editor: IntegerCellEditor, groupTotalsFormatter: sumTotalsFormatter});
		columns1.push({ id: "sep", name: "Sept", field: "sep", width: 80, headerCssClass: "alignHeaderRight",validator: validator,  formatter: IntegerCellFormatter, editor: IntegerCellEditor, groupTotalsFormatter: sumTotalsFormatter});

		var data1 = [];
		data1.push({ rowid : '0', cust1: '08:30 AM', cust2: 'Monday', cust3: 'A1', percAllocation:  2, jan: 10, feb: 2, mar: 10, apr: 5, may: 8, jun: 30, jul: 1, aug: 5, sep: 30});
		data1.push({ rowid : '1', cust1: '08:30 AM', cust2: 'Monday', cust3: 'A1', percAllocation: 2, jan: 10, feb: 20, mar: 2, apr: 5, may: 30, jun: 30, jul: 30, aug: 30, sep: 30});
		data1.push({ rowid : '2', cust1: '08:30 AM', cust2: 'Monday', cust3: 'A2', percAllocation: 40, jan: 10, feb: 2, mar: 10, apr: 5, may: 30, jun: 30, jul: 30, aug: 5, sep: 30});
		data1.push({ rowid : '3', cust1: '08:30 AM', cust2: 'Tuesday', cust3: 'A1', percAllocation:  2, jan: 10, feb:2, mar: 10, apr: 5, may: 8, jun: 30, jul: 1, aug: 5, sep: 30});
		data1.push({ rowid : '4', cust1: '08:30 AM', cust2: 'Tuesday', cust3: 'A1', percAllocation: 2, jan: 10, feb: 20, mar: 2, apr: 5, may: 30, jun: 30, jul: 30, aug: 30, sep: 30});
		data1.push({ rowid : '5', cust1: '08:30 AM', cust2: 'Tuesday', cust3: 'A2', percAllocation: 40, jan: 10, feb: 2, mar: 10, apr: 5, may: 30, jun: 30, jul: 30, aug: 5, sep: 30});
		data1.push({ rowid : '6', cust1: '08:30 AM', cust2: 'Wednesday', cust3: 'A1', percAllocation:  2, jan: 10, feb: 2, mar: 10, apr: 5, may: 8, jun: 30, jul: 1, aug: 5, sep: 30});
		data1.push({ rowid : '7', cust1: '08:30 AM', cust2: 'Wednesday', cust3: 'A1', percAllocation: 2, jan: 10, feb: 20, mar: 2, apr: 5, may: 30, jun: 30, jul: 30, aug: 30, sep: 30});
		data1.push({ rowid : '8', cust1: '08:30 AM', cust2: 'Wednesday', cust3: 'A2', percAllocation: 40, jan: 10, feb: 2, mar: 10, apr: 5, may: 30, jun: 30, jul: 30, aug: 5, sep: 30});
		
		var options1 = {
			columns: columns1,
			idProperty:'rowid',
			dataset: data1,
			showFilter: false,
			showDrillDown: false,
			showFooter: false,
			showGridSettings: false,
			showFilter: false,
			forceFitColumns: false,
			showCheckboxes: false,
			showGridSettings:false,
			enableGrouping: true,
			savePersonalization: false,
			frozenColumn: 4,
			multiSelect:false,
			showSummaryRow: false

		};

		$(document).ready(function () {
			$('#inforDatagrid1').height(300);
			
			var grid1 = $("#inforDatagrid1").inforDataGrid(options1);
			var dataView1= grid1.getData();
			dataView1.groupBy(
				"cust2",
				function (g) {
					return "<span class='inforGroupText'>" + g.value + "  <span class='inforGroupSummaryText'>(" + g.count + " items)</span></span>";
				},
				function (a, b) {return a.value - b.value;}	//sorting comparer.
			);

			dataView1.setAggregators([
				new Slick.Data.Aggregators.Sum("percAllocation"),
				new Slick.Data.Aggregators.Sum("jan"),
				new Slick.Data.Aggregators.Sum("feb"),
				new Slick.Data.Aggregators.Sum("mar"),
				new Slick.Data.Aggregators.Sum("apr"),
				new Slick.Data.Aggregators.Sum("jun"),
				new Slick.Data.Aggregators.Sum("jul"),
				new Slick.Data.Aggregators.Sum("aug"),
				new Slick.Data.Aggregators.Sum("sep")
			], false);

		});
	
	</script>

</body>
</html>
