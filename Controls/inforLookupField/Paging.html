<!DOCTYPE HTML>
<html>
<head>
	<!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge'><![endif]-->
	<meta charset="utf-8" />
	<title>Infor Lookup Field : Paging </title>

	<link href="../Release/inforControlsCombined.css" rel="stylesheet" />
	<script src="../Release/jquery-1.11.1.min.js"></script>
	<script src="../Release/jquery-ui-1.10.4.custom.min.js"></script>
	<script src="../Release/inforControlsCombined.js" ></script>
	<script src="../inforDataGrid/js/inforDataGrid.js" ></script>
	<script src="js/inforLookupField.js" ></script>

</head>
<body class="inforHidden">
	<div class="inforSingleColumnLayout autoLabelWidth">
		<div class="column1">
			<label class="inforLabel">Remote Data</label>
			<input class="inforLookupField" type="text" id="inforLookupFieldRemote"><br>
		</div>
	</div>

	<script>
			//Globalize.culture("ar-SA");

			var cache = {},	//implement a redumentary caching of requests for performance
				options = {
					editable: false,
					showDrillDown: false,
					showFilter: false,
					showCheckboxes: false,
					showStatusIndicators: false,
					multiSelect: false,
					pagingMode: PagingModes.PagerServerSide,
					pageSize: 10,
					showFooter: true,
					savePersonalization: false,
					autoHeightToPageSize: true,
					idProperty: "officeId"
				};

			//Define a function to do whats needed to get the page. This is called in two places: source (initial Page) and onPageRequested
			var baseqry  = "http://localhost:4000/api/compressors?";

			//initialize the control options - the source function is called when a user requests by typing or clicking the button
			$("#inforLookupFieldRemote").inforLookupField({
				gridOptions: options, 	//set the grid options (columns and settings). dataset will be empty.
				returnField: "id",
				width: 400,
				height: "auto",
				editable: true,
				typeAheadSearch: true,
				onPageRequested: function (e, args) {
						//get a new page:
					var qry = baseqry + "&pageSize="+args.pageSize+"&pageNum="+(args.pageNum);


					$.getJSON(qry,
					 function (jsonResult) {
						var newData = jsonResult.data;
						e.datagrid.mergeData(newData, args.pageNum, parseInt(jsonResult.data.length));
					 });
				},
				source: function (request, response) {
					var self = $(this.element);

					/*check if the request is in the cache to avoid extra requests.*/
					if ( request.term in cache ) {
						response( cache[ request.term ].data , cache[ request.term ].columns,  cache[ request.term ].totalCount);
						return;
					}

					//Set the idProperty using set options or any other grid property

					//get first page:
					var qry = baseqry + "&pageNum=1&pageSize="+options.pageSize;
					//add initial sort condition

					if (request.term)
						qry += "&$filter=substringof('"+request.term+"', city) eq true";

					$.getJSON(qry,
					 function (jsonResult) {

					   //Pass in the grid columns We want to see. This could come from the Json Request as well.
					   var columns = [];
					   columns.push({ id: "id", name: "id", field: "id", width: 135, selectable: true, formatter:TextCellFormatter, editor: TextCellEditor, filterType: TextFilter });
					   columns.push({ id: "activity", name: "activity", field: "activity",  formatter: TextCellFormatter, editor: SelectCellEditor, options: ["New Jersey", "California", "Nevada", "Virginia", "Missouri"]});
					   columns.push({ id: "productName", name: "productName", field: "productName", width: 80, headerCssClass : "alignRight", formatter: IntegerCellFormatter, editor: IntegerCellEditor, filterType: IntegerFilter});

					   //set various control properties retrieved after the request

					   //cache for later
					   cache[ request.term ] = {data: jsonResult.data, columns : columns, totalCount : jsonResult.data.length};

					   //pass in total count and options
					   options.idProperty ='id';
					   response(jsonResult.data, columns, jsonResult.data, options);
					 });
				}
			});

		   //remove class which hides the page for smoother loading and size fields...Not necessary specifically for this control.
		   $("body").inforForm();
	 </script>
</body>
</html>
